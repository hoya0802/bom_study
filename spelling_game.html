<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>소리 듣고 단어 완성하기</title>
  <style>
    body { font-family: 'Segoe UI', '맑은 고딕', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; margin:0; }
    .container { max-width: 600px; margin: 40px auto; background: #fff; border-radius: 20px; box-shadow: 0 8px 32px #0001; padding: 32px 18px; }
    .header { text-align: center; margin-bottom: 24px; }
    .header h1 { font-size: 2rem; color: #333; }
    .back-btn { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.2); color: #333; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 14px; }
    .game-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; background: #f8f9fa; padding: 16px; border-radius: 12px; }
    .score, .round { background: #fff; padding: 8px 18px; border-radius: 8px; box-shadow: 0 2px 8px #0001; font-weight: bold; }
    .score { color: #28a745; } .round { color: #007bff; }
    .question-area { background: #f8f9fa; padding: 24px; border-radius: 12px; margin-bottom: 18px; text-align: center; }
    .play-btn { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 12px 28px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 18px; }
    .play-btn:hover { background: #20c997; }
    .spelling-area { display: flex; gap: 8px; justify-content: center; margin-bottom: 18px; }
    .spelling-box { min-width: 32px; min-height: 38px; border: 2px solid #e1e5e9; border-radius: 8px; background: #fff; font-size: 1.3rem; text-align: center; line-height: 38px; font-weight: bold; }
    .alphabet-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 18px; }
    .alpha-btn { background: #fff; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1.1rem; font-weight: bold; padding: 10px 16px; cursor: pointer; transition: all 0.2s; }
    .alpha-btn.selected { background: #667eea; color: #fff; border-color: #667eea; }
    .alpha-btn:disabled { background: #eee; color: #aaa; border-color: #eee; cursor: not-allowed; }
    .action-buttons { display: flex; gap: 12px; justify-content: center; margin-top: 10px; }
    .btn { padding: 10px 22px; border: none; border-radius: 8px; font-size: 15px; font-weight: bold; cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: #007bff; color: #fff; }
    .btn-primary:disabled { background: #6c757d; cursor: not-allowed; }
    .btn-success { background: #28a745; color: #fff; }
    .result-message { font-size: 1.1rem; font-weight: bold; margin: 16px 0; padding: 10px; border-radius: 8px; }
    .result-correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .result-incorrect { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    @media (max-width: 600px) { .container { padding: 12px 2vw; } .header h1 { font-size: 1.2rem; } .spelling-area { gap: 4px; } .alphabet-grid { gap: 6px; } }
  </style>
</head>
<body>
  <div class="container">
    <button class="back-btn" onclick="goBack()">← 홈으로</button>
    <div class="header"><h1>소리 듣고 단어 완성하기</h1></div>
    <div class="game-info">
      <div class="score">점수: <span id="score">0</span></div>
      <div class="round">라운드: <span id="round">1</span>/5</div>
    </div>
    <div class="question-area">
      <button class="play-btn" onclick="playSound()">🔊 소리 듣기</button>
      <div class="spelling-area" id="spellingArea"></div>
      <div class="alphabet-grid" id="alphabetGrid"></div>
      <div class="action-buttons">
        <button class="btn btn-primary" id="checkBtn" onclick="checkAnswer()" disabled>정답 확인</button>
        <button class="btn btn-success" id="nextBtn" onclick="nextRound()" disabled>다음</button>
      </div>
      <div class="result-message" id="resultMessage" style="display:none;"></div>
    </div>
  </div>
  <script>
    // 권한 확인
    function checkPermission() {
        const currentUser = getCurrentUser();
        if (!currentUser) {
            alert('로그인이 필요합니다.');
            location.href = 'index.html';
            return false;
        }
        
        return true;
    }
    
    // 샘플 데이터 (단어)
    const questions = [
      { word: 'cat' },
      { word: 'dog' },
      { word: 'bed' },
      { word: 'fish' },
      { word: 'hat' }
    ];
    let current = 0, score = 0, answer = [], selected = [], alphaPool = [];
    function renderQuestion() {
      document.getElementById('round').textContent = current+1;
      document.getElementById('score').textContent = score;
      answer = questions[current].word.split('');
      selected = [];
      // 스펠링 박스
      const area = document.getElementById('spellingArea');
      area.innerHTML = '';
      for (let i=0; i<answer.length; i++) {
        const box = document.createElement('div');
        box.className = 'spelling-box';
        box.textContent = selected[i] || '';
        area.appendChild(box);
      }
      // 알파벳 선택지
      alphaPool = shuffle([...answer, ...randomAlphabets(answer.length)]);
      const grid = document.getElementById('alphabetGrid');
      grid.innerHTML = '';
      alphaPool.forEach((ch, idx) => {
        const btn = document.createElement('button');
        btn.className = 'alpha-btn';
        btn.textContent = ch;
        btn.onclick = () => selectAlpha(idx, ch);
        grid.appendChild(btn);
      });
      document.getElementById('checkBtn').disabled = true;
      document.getElementById('nextBtn').disabled = true;
      document.getElementById('resultMessage').style.display = 'none';
      updateSpelling();
    }
    function selectAlpha(idx, ch) {
      if (selected.length < answer.length) {
        selected.push(ch);
        document.getElementsByClassName('alpha-btn')[idx].disabled = true;
        updateSpelling();
      }
      if (selected.length === answer.length) {
        document.getElementById('checkBtn').disabled = false;
      }
    }
    function updateSpelling() {
      const area = document.getElementById('spellingArea');
      for (let i=0; i<answer.length; i++) {
        area.children[i].textContent = selected[i] || '';
      }
    }
    function checkAnswer() {
      const userWord = selected.join('');
      const correct = answer.join('');
      if (userWord === correct) {
        score += 20;
        showResult('정답입니다! +20점', true);
      } else {
        showResult(`틀렸습니다. 정답: ${correct}`, false);
      }
      document.getElementById('checkBtn').disabled = true;
      document.getElementById('nextBtn').disabled = false;
      document.getElementById('score').textContent = score;
    }
    function showResult(msg, isCorrect) {
      const el = document.getElementById('resultMessage');
      el.textContent = msg;
      el.className = 'result-message ' + (isCorrect ? 'result-correct' : 'result-incorrect');
      el.style.display = 'block';
    }
    function nextRound() {
      current++;
      if (current >= questions.length) {
        alert(`게임 종료! 최종 점수: ${score}`);
        current = 0; score = 0;
      }
      renderQuestion();
    }
    function playSound() {
      const utter = new SpeechSynthesisUtterance(questions[current].word);
      utter.lang = 'en-US';
      utter.rate = 0.8;
      utter.pitch = 1.1;
      window.speechSynthesis.speak(utter);
    }
    function randomAlphabets(n) {
      const alphabet = 'abcdefghijklmnopqrstuvwxyz';
      let arr = [];
      while (arr.length < n) {
        const ch = alphabet[Math.floor(Math.random()*alphabet.length)];
        if (!answer.includes(ch) && !arr.includes(ch)) arr.push(ch);
      }
      return arr;
    }
    function shuffle(arr) {
      for (let i=arr.length-1; i>0; i--) {
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
    function goBack() { window.location.href = 'index.html'; }
    window.onload = function() {
        if (checkPermission()) {
            renderQuestion();
        }
    };
  </script>
</body>
</html> 
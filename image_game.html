<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Í∑∏Î¶º Î≥¥Í≥† Îã®Ïñ¥ Ï∞æÍ∏∞</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="config.js"></script>
  <style>
    body { font-family: 'Segoe UI', 'ÎßëÏùÄ Í≥†Îîï', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; margin:0; }
    .container { max-width: 600px; margin: 40px auto; background: #fff; border-radius: 20px; box-shadow: 0 8px 32px #0001; padding: 32px 18px; }
    .header { text-align: center; margin-bottom: 24px; }
    .header h1 { font-size: 2rem; color: #333; }
    .back-btn { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.2); color: #333; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 14px; }
    .game-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; background: #f8f9fa; padding: 16px; border-radius: 12px; }
    .score, .round { background: #fff; padding: 8px 18px; border-radius: 8px; box-shadow: 0 2px 8px #0001; font-weight: bold; }
    .score { color: #28a745; } .round { color: #007bff; }
    .question-area { background: #f8f9fa; padding: 24px; border-radius: 12px; margin-bottom: 18px; text-align: center; }
    .question-img { width: 120px; height: 120px; object-fit: contain; margin-bottom: 18px; border-radius: 12px; background: #fff; border: 1.5px solid #eee; }
    .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 18px; }
    .option-btn { background: #fff; border: 2.5px solid #e9ecef; padding: 18px; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: all 0.2s; min-height: 60px; }
    .option-btn.selected { border-color: #667eea; background: #667eea; color: #fff; }
    .option-btn.correct { border-color: #28a745; background: #28a745; color: #fff; }
    .option-btn.incorrect { border-color: #dc3545; background: #dc3545; color: #fff; }
    .action-buttons { display: flex; gap: 12px; justify-content: center; margin-top: 10px; }
    .btn { padding: 10px 22px; border: none; border-radius: 8px; font-size: 15px; font-weight: bold; cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: #007bff; color: #fff; }
    .btn-primary:disabled { background: #6c757d; cursor: not-allowed; }
    .btn-success { background: #28a745; color: #fff; }
    .result-message { font-size: 1.1rem; font-weight: bold; margin: 16px 0; padding: 10px; border-radius: 8px; }
    .result-correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .result-incorrect { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    @media (max-width: 600px) { .container { padding: 12px 2vw; } .header h1 { font-size: 1.2rem; } .options-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <button class="back-btn" onclick="goBack()">‚Üê ÌôàÏúºÎ°ú</button>
    <div class="header"><h1>Í∑∏Î¶º Î≥¥Í≥† Îã®Ïñ¥ Ï∞æÍ∏∞</h1></div>
    <div class="game-info">
      <div class="score">Ï†êÏàò: <span id="score">0</span></div>
      <div class="round">ÎùºÏö¥Îìú: <span id="round">1</span>/5</div>
    </div>
    <div class="question-area">
      <img id="questionImg" class="question-img" src="" alt="Î¨∏Ï†ú Ïù¥ÎØ∏ÏßÄ">
      <div class="options-grid" id="optionsGrid"></div>
      <div class="action-buttons">
        <button class="btn btn-primary" id="checkBtn" onclick="checkAnswer()" disabled>Ï†ïÎãµ ÌôïÏù∏</button>
        <button class="btn btn-success" id="nextBtn" onclick="nextRound()" disabled>Îã§Ïùå</button>
      </div>
      <div class="result-message" id="resultMessage" style="display:none;"></div>
    </div>
  </div>
  <script>
    // Í∂åÌïú ÌôïÏù∏
    function checkPermission() {
        const currentUser = getCurrentUser();
        if (!currentUser) {
            alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
            location.href = 'index.html';
            return false;
        }
        
        return true;
    }
    
    // ÌååÎãâÏä§ ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ (Ïù¥Î™®ÏßÄ:Îã®Ïñ¥) - Îã®Î™®Ïùå Îã®Ïñ¥Îì§Í≥º Ïù¥Î™®ÏßÄ Îß§Ìïë
    const phonicsData = {
        'a': [
            { emoji: 'üê±', word: 'cat', meaning: 'Í≥†ÏñëÏù¥' },
            { emoji: 'üß¢', word: 'hat', meaning: 'Î™®Ïûê' },
            { emoji: 'ü¶á', word: 'bat', meaning: 'Î∞ïÏ•ê' },
            { emoji: 'üêÄ', word: 'rat', meaning: 'Ï•ê' },
            { emoji: 'üèè', word: 'bat', meaning: 'Î∞©ÎßùÏù¥' },
            { emoji: 'üó∫Ô∏è', word: 'map', meaning: 'ÏßÄÎèÑ' },
            { emoji: 'üß¢', word: 'cap', meaning: 'Î™®Ïûê' },
            { emoji: 'üëã', word: 'tap', meaning: 'Í∞ÄÎ≥çÍ≤å ÏπòÎã§' },
            { emoji: 'ü¶µ', word: 'lap', meaning: 'Î¨¥Î¶é' },
            { emoji: 'üëú', word: 'bag', meaning: 'Í∞ÄÎ∞©' },
            { emoji: 'üè∑Ô∏è', word: 'tag', meaning: 'Íº¨Î¶¨Ìëú' },
            { emoji: 'üßΩ', word: 'rag', meaning: 'Í±∏Î†à' },
            { emoji: 'üõèÔ∏è', word: 'mat', meaning: 'Îß§Ìä∏' },
            { emoji: 'ü™ë', word: 'sat', meaning: 'ÏïâÏïòÎã§' },
            { emoji: 'üê∑', word: 'fat', meaning: 'Îö±Îö±Ìïú' }
        ],
        'e': [
            { emoji: 'üõèÔ∏è', word: 'bed', meaning: 'Ïπ®ÎåÄ' },
            { emoji: 'üî¥', word: 'red', meaning: 'Îπ®Í∞Ñ' },
            { emoji: 'üçΩÔ∏è', word: 'fed', meaning: 'Î®πÏòÄÎã§' },
            { emoji: 'üí°', word: 'led', meaning: 'Ïù¥ÎÅåÏóàÎã§' },
            { emoji: 'üì•', word: 'get', meaning: 'ÏñªÎã§' },
            { emoji: '‚úÖ', word: 'let', meaning: 'ÌóàÎùΩÌïòÎã§' },
            { emoji: 'ü§ù', word: 'met', meaning: 'ÎßåÎÇ¨Îã§' },
            { emoji: 'üï∏Ô∏è', word: 'net', meaning: 'Í∑∏Î¨º' },
            { emoji: 'üêï', word: 'pet', meaning: 'Ïï†ÏôÑÎèôÎ¨º' },
            { emoji: 'üì±', word: 'set', meaning: 'ÎÜìÎã§' },
            { emoji: 'üíß', word: 'wet', meaning: 'Ï†ñÏùÄ' },
            { emoji: 'üé≤', word: 'bet', meaning: 'ÎÇ¥Í∏∞ÌïòÎã§' },
            { emoji: '‚úàÔ∏è', word: 'jet', meaning: 'Ï†úÌä∏Í∏∞' },
            { emoji: 'üè•', word: 'vet', meaning: 'ÏàòÏùòÏÇ¨' },
            { emoji: 'üï≥Ô∏è', word: 'den', meaning: 'Íµ¥' },
            { emoji: 'üêî', word: 'hen', meaning: 'ÏïîÌÉâ' },
            { emoji: 'üë®', word: 'men', meaning: 'ÎÇ®ÏûêÎì§' },
            { emoji: '‚úèÔ∏è', word: 'pen', meaning: 'Ìéú' },
            { emoji: 'üîü', word: 'ten', meaning: 'Ïó¥' }
        ],
        'i': [
            { emoji: 'üêò', word: 'big', meaning: 'ÌÅ∞' },
            { emoji: '‚õèÔ∏è', word: 'dig', meaning: 'ÌååÎã§' },
            { emoji: 'üå≥', word: 'fig', meaning: 'Î¨¥ÌôîÍ≥º' },
            { emoji: 'üê∑', word: 'pig', meaning: 'ÎèºÏßÄ' },
            { emoji: '‚öôÔ∏è', word: 'rig', meaning: 'Ïû•ÎπÑ' },
            { emoji: 'üë®‚Äçü¶≤', word: 'wig', meaning: 'Í∞ÄÎ∞ú' },
            { emoji: 'üç™', word: 'bit', meaning: 'Ï°∞Í∏à' },
            { emoji: 'üëï', word: 'fit', meaning: 'ÎßûÎã§' },
            { emoji: 'üëä', word: 'hit', meaning: 'ÏπòÎã§' },
            { emoji: 'üß∞', word: 'kit', meaning: 'ÎèÑÍµ¨ÏÉÅÏûê' },
            { emoji: 'üí°', word: 'lit', meaning: 'Î∞ùÌòîÎã§' },
            { emoji: 'üï≥Ô∏è', word: 'pit', meaning: 'Íµ¨Îç©Ïù¥' },
            { emoji: 'ü™ë', word: 'sit', meaning: 'ÏïâÎã§' },
            { emoji: 'üß†', word: 'wit', meaning: 'Ïû¨Ïπò' },
            { emoji: 'üóëÔ∏è', word: 'bin', meaning: 'ÌÜµ' },
            { emoji: 'üîä', word: 'din', meaning: 'ÏÜåÏùå' },
            { emoji: 'üêü', word: 'fin', meaning: 'ÏßÄÎäêÎü¨ÎØ∏' },
            { emoji: 'üìå', word: 'pin', meaning: 'ÌïÄ' },
            { emoji: 'üòà', word: 'sin', meaning: 'Ï£Ñ' },
            { emoji: 'ü•´', word: 'tin', meaning: 'Ï£ºÏÑù' },
            { emoji: 'üèÜ', word: 'win', meaning: 'Ïù¥Í∏∞Îã§' }
        ],
        'o': [
            { emoji: 'üêï', word: 'dog', meaning: 'Í∞ú' },
            { emoji: 'üå´Ô∏è', word: 'fog', meaning: 'ÏïàÍ∞ú' },
            { emoji: 'üê∑', word: 'hog', meaning: 'ÎèºÏßÄ' },
            { emoji: 'üèÉ', word: 'jog', meaning: 'Ï°∞ÍπÖÌïòÎã§' },
            { emoji: 'ü™µ', word: 'log', meaning: 'ÌÜµÎÇòÎ¨¥' },
            { emoji: 'üì¶', word: 'box', meaning: 'ÏÉÅÏûê' },
            { emoji: 'ü¶ä', word: 'fox', meaning: 'Ïó¨Ïö∞' },
            { emoji: 'üß¶', word: 'sox', meaning: 'ÏñëÎßê' },
            { emoji: 'üî•', word: 'hot', meaning: 'Îú®Í±∞Ïö¥' },
            { emoji: 'üé≤', word: 'lot', meaning: 'ÎßéÏù¥' },
            { emoji: '‚ùå', word: 'not', meaning: 'ÏïÑÎãàÎã§' },
            { emoji: 'üçØ', word: 'pot', meaning: 'ÎÉÑÎπÑ' },
            { emoji: 'üçé', word: 'rot', meaning: 'Ïç©Îã§' },
            { emoji: 'üë∂', word: 'tot', meaning: 'ÏïÑÍ∏∞' },
            { emoji: 'üîµ', word: 'dot', meaning: 'Ï†ê' },
            { emoji: 'üõèÔ∏è', word: 'cot', meaning: 'Í∞ÑÏù¥Ïπ®ÎåÄ' },
            { emoji: 'ü§ñ', word: 'bot', meaning: 'Î°úÎ¥á' },
            { emoji: 'üì•', word: 'got', meaning: 'ÏñªÏóàÎã§' }
        ],
        'u': [
            { emoji: 'üêõ', word: 'bug', meaning: 'Î≤åÎ†à' },
            { emoji: 'ü§ó', word: 'hug', meaning: 'ÏïàÏïÑÏ£ºÎã§' },
            { emoji: 'ü´ñ', word: 'jug', meaning: 'Ï£ºÏ†ÑÏûê' },
            { emoji: '‚òï', word: 'mug', meaning: 'Î®∏Í∑∏Ïªµ' },
            { emoji: 'üü´', word: 'rug', meaning: 'Îü¨Í∑∏' },
            { emoji: 'üö¢', word: 'tug', meaning: 'ÎÅåÎã§' },
            { emoji: '‚õèÔ∏è', word: 'dug', meaning: 'Ìå†Îã§' },
            { emoji: 'üëú', word: 'lug', meaning: 'ÎÅåÎã§' },
            { emoji: 'üêï', word: 'pug', meaning: 'ÌçºÍ∑∏' },
            { emoji: 'üçØ', word: 'sug', meaning: 'ÏÑ§ÌÉï' },
            { emoji: 'üîÑ', word: 'but', meaning: 'ÌïòÏßÄÎßå' },
            { emoji: '‚úÇÔ∏è', word: 'cut', meaning: 'ÏûêÎ•¥Îã§' },
            { emoji: 'ü´Å', word: 'gut', meaning: 'Ï∞ΩÏûê' },
            { emoji: 'üè†', word: 'hut', meaning: 'Ïò§ÎëêÎßâ' },
            { emoji: 'üó°Ô∏è', word: 'jut', meaning: 'ÌäÄÏñ¥ÎÇòÏò§Îã§' },
            { emoji: 'ü•ú', word: 'nut', meaning: 'Í≤¨Í≥ºÎ•ò' },
            { emoji: 'üì¶', word: 'put', meaning: 'ÎÜìÎã§' },
            { emoji: 'üõ§Ô∏è', word: 'rut', meaning: 'Í≥†Îûë' },
            { emoji: 'üò§', word: 'tut', meaning: 'Ìù•' },
            { emoji: 'ü•ñ', word: 'bun', meaning: 'Îπµ' },
            { emoji: 'üéâ', word: 'fun', meaning: 'Ïû¨ÎØ∏' },
            { emoji: 'üî´', word: 'gun', meaning: 'Ï¥ù' },
            { emoji: 'üë©‚Äçü¶≥', word: 'nun', meaning: 'ÏàòÎÖÄ' },
            { emoji: 'üòÑ', word: 'pun', meaning: 'ÎßêÏû•ÎÇú' },
            { emoji: 'üèÉ', word: 'run', meaning: 'Îã¨Î¶¨Îã§' },
            { emoji: '‚òÄÔ∏è', word: 'sun', meaning: 'ÌÉúÏñë' },
            { emoji: 'üõ¢Ô∏è', word: 'tun', meaning: 'ÌÅ∞ ÌÜµ' },
            { emoji: 'üêª', word: 'cub', meaning: 'ÏÉàÎÅº' },
            { emoji: 'üéØ', word: 'hub', meaning: 'Ï§ëÏã¨' },
            { emoji: 'üç∫', word: 'pub', meaning: 'Ïà†Ïßë' },
            { emoji: 'ü§≤', word: 'rub', meaning: 'Î¨∏ÏßÄÎ•¥Îã§' },
            { emoji: 'üõÅ', word: 'tub', meaning: 'ÏöïÏ°∞' }
        ]
    };
    
    // ÌòÑÏû¨ ÌïôÏäµÌï† Î™®Ïùå ÏÑ†ÌÉù (ÎùºÏö¥ÎìúÎ≥ÑÎ°ú Îã§Î•∏ Î™®Ïùå)
    function getCurrentVowel(round) {
        const vowels = ['a', 'e', 'i', 'o', 'u'];
        return vowels[(round - 1) % vowels.length];
    }
    
    // ÌòÑÏû¨ ÎùºÏö¥ÎìúÏùò Îã®Ïñ¥Îì§ Í∞ÄÏ†∏Ïò§Í∏∞
    function getCurrentWords(round) {
        const vowel = getCurrentVowel(round);
        return phonicsData[vowel];
    }
    let current = 0, score = 0, selected = null;
    function renderQuestion() {
      document.getElementById('round').textContent = current+1;
      document.getElementById('score').textContent = score;
      
      // ÌòÑÏû¨ ÎùºÏö¥ÎìúÏóê ÎßûÎäî Î™®ÏùåÍ≥º Îã®Ïñ¥ ÏÑ†ÌÉù
      const currentVowel = getCurrentVowel(current + 1);
      const currentWords = getCurrentWords(current + 1);
      const randomWordData = currentWords[Math.floor(Math.random() * currentWords.length)];
      
      // Ïù¥Î™®ÏßÄ ÌëúÏãú (Ïù¥ÎØ∏ÏßÄ ÎåÄÏã†)
      const imgElement = document.getElementById('questionImg');
      imgElement.style.display = 'none';
      
      // Ïù¥Î™®ÏßÄ Ïª®ÌÖåÏù¥ÎÑà ÏÉùÏÑ± ÎòêÎäî ÏóÖÎç∞Ïù¥Ìä∏
      let emojiContainer = document.getElementById('emojiContainer');
      if (!emojiContainer) {
        emojiContainer = document.createElement('div');
        emojiContainer.id = 'emojiContainer';
        emojiContainer.style.cssText = `
          width: 120px; 
          height: 120px; 
          background: #f8f9fa; 
          border: 2px solid #dee2e6; 
          border-radius: 12px; 
          display: flex; 
          align-items: center; 
          justify-content: center; 
          font-size: 4rem; 
          margin: 0 auto 18px auto;
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        `;
        imgElement.parentNode.insertBefore(emojiContainer, imgElement);
      }
      emojiContainer.textContent = randomWordData.emoji;
      
      // ÌòÑÏû¨ ÌïôÏäµ Ï§ëÏù∏ Î™®Ïùå ÌëúÏãú
      console.log(`ÎùºÏö¥Îìú ${current + 1}: Î™®Ïùå '${currentVowel}' ÌïôÏäµ Ï§ë - Îã®Ïñ¥: ${randomWordData.word} (${randomWordData.meaning}) - Ïù¥Î™®ÏßÄ: ${randomWordData.emoji}`);
      
      const grid = document.getElementById('optionsGrid');
      grid.innerHTML = '';
      
      // ÏÑ†ÌÉùÏßÄ ÏÉùÏÑ± (Ï†ïÎãµ + Îã§Î•∏ Îã®Ïñ¥Îì§)
      const options = [randomWordData.word];
      const allWords = Object.values(phonicsData).flat().map(item => item.word);
      const otherWords = allWords.filter(word => word !== randomWordData.word);
      
      for (let i = 0; i < 3; i++) {
        const randomWord = otherWords[Math.floor(Math.random() * otherWords.length)];
        if (!options.includes(randomWord)) {
          options.push(randomWord);
        }
      }
      
      // ÏÑ†ÌÉùÏßÄ ÏÑûÍ∏∞
      for (let i = options.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [options[i], options[j]] = [options[j], options[i]];
      }
      
      options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = opt;
        btn.onclick = () => selectOption(btn, opt);
        grid.appendChild(btn);
      });
      
      selected = null;
      document.getElementById('checkBtn').disabled = true;
      document.getElementById('nextBtn').disabled = true;
      document.getElementById('resultMessage').style.display = 'none';
    }
    function selectOption(btn, opt) {
      document.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));
      btn.classList.add('selected');
      selected = opt;
      document.getElementById('checkBtn').disabled = false;
    }
    function checkAnswer() {
      if (!selected) return;
      
      // ÌòÑÏû¨ ÎùºÏö¥ÎìúÏùò Ï†ïÎãµ Îã®Ïñ¥ Í∞ÄÏ†∏Ïò§Í∏∞
      const currentVowel = getCurrentVowel(current + 1);
      const currentWords = getCurrentWords(current + 1);
      const emojiContainer = document.getElementById('emojiContainer');
      const currentEmoji = emojiContainer.textContent;
      const correctWordData = currentWords.find(item => item.emoji === currentEmoji);
      const correct = correctWordData ? correctWordData.word : '';
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.onclick = null;
        if (btn.textContent === correct) btn.classList.add('correct');
        else if (btn.textContent === selected) btn.classList.add('incorrect');
      });
      if (selected === correct) {
        score += 20;
        showResult('Ï†ïÎãµÏûÖÎãàÎã§! +20Ï†ê', true);
      } else {
        showResult(`ÌãÄÎ†∏ÏäµÎãàÎã§. Ï†ïÎãµ: ${correct}`, false);
      }
      document.getElementById('checkBtn').disabled = true;
      document.getElementById('nextBtn').disabled = false;
      document.getElementById('score').textContent = score;
    }
    function showResult(msg, isCorrect) {
      const el = document.getElementById('resultMessage');
      el.textContent = msg;
      el.className = 'result-message ' + (isCorrect ? 'result-correct' : 'result-incorrect');
      el.style.display = 'block';
    }
    function nextRound() {
      current++;
      if (current >= questions.length) {
        alert(`Í≤åÏûÑ Ï¢ÖÎ£å! ÏµúÏ¢Ö Ï†êÏàò: ${score}`);
        current = 0; score = 0;
      }
      renderQuestion();
    }
    function goBack() { window.location.href = 'index.html'; }
    window.onload = function() {
        if (checkPermission()) {
            renderQuestion();
        }
    };
  </script>
</body>
</html> 
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê·¸ë¦¼ ë³´ê³  ë‹¨ì–´ ì°¾ê¸°</title>
      <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="config.js"></script>
    <script src="user-theme.js"></script>
  <style>
    body { font-family: 'Segoe UI', 'ë§‘ì€ ê³ ë”•', Arial, sans-serif; background: var(--user-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%)); min-height: 100vh; margin:0; }
    .container { max-width: 600px; margin: 40px auto; background: #fff; border-radius: 20px; box-shadow: 0 8px 32px #0001; padding: 32px 18px; }
    .header { text-align: center; margin-bottom: 24px; }
    .header h1 { font-size: 2rem; color: #333; }
    .back-btn { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.2); color: #333; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 14px; }
    .game-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; background: #f8f9fa; padding: 16px; border-radius: 12px; }
    .score, .round { background: #fff; padding: 8px 18px; border-radius: 8px; box-shadow: 0 2px 8px #0001; font-weight: bold; }
    .score { color: #28a745; } .round { color: #007bff; }
    .question-area { background: #f8f9fa; padding: 24px; border-radius: 12px; margin-bottom: 18px; text-align: center; }
    .question-img { width: 120px; height: 120px; object-fit: contain; margin-bottom: 18px; border-radius: 12px; background: #fff; border: 1.5px solid #eee; }
    .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 18px; }
    .option-btn { background: #fff; border: 2.5px solid #e9ecef; padding: 18px; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: all 0.2s; min-height: 60px; }
    .option-btn.selected { border-color: var(--user-primary-color, #667eea); background: var(--user-primary-color, #667eea); color: #fff; }
    .option-btn.correct { border-color: #28a745; background: #28a745; color: #fff; }
    .option-btn.incorrect { border-color: #dc3545; background: #dc3545; color: #fff; }
    .action-buttons { display: flex; gap: 12px; justify-content: center; margin-top: 10px; }
    .btn { padding: 10px 22px; border: none; border-radius: 8px; font-size: 15px; font-weight: bold; cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: var(--user-gradient, #007bff) !important; color: #fff; }
    .btn-primary:disabled { background: #6c757d; cursor: not-allowed; }
    .btn-success { background: var(--play-btn-gradient, #28a745) !important; color: #fff; }
    .result-message { font-size: 1.1rem; font-weight: bold; margin: 16px 0; padding: 10px; border-radius: 8px; }
    .result-correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .result-incorrect { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    @media (max-width: 600px) { .container { padding: 12px 2vw; } .header h1 { font-size: 1.2rem; } .options-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <button class="back-btn" onclick="goBack()">â† í™ˆìœ¼ë¡œ</button>
    <div class="header"><h1>ì´ëª¨ì§€ ë³´ê³  ë‹¨ì–´ ì°¾ê¸°</h1></div>
    <div id="setSelectArea" style="margin-bottom:24px; text-align:center;"></div>
    <div class="game-info">
      <div class="score">ì ìˆ˜: <span id="score">0</span></div>
      <div class="round">ë¼ìš´ë“œ: <span id="round">1</span>/5</div>
    </div>
    <div class="question-area">
      <img id="questionImg" class="question-img" src="" alt="ë¬¸ì œ ì´ë¯¸ì§€" style="display:none;">
      <div class="options-grid" id="optionsGrid"></div>
      <div class="action-buttons">
        <button class="btn btn-primary" id="checkBtn" onclick="checkAnswer()" disabled>ì •ë‹µ í™•ì¸</button>
        <button class="btn btn-success" id="nextBtn" onclick="nextRound()" disabled>ë‹¤ìŒ</button>
      </div>
      <div class="result-message" id="resultMessage" style="display:none;"></div>
    </div>
    <div id="successPopup" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); align-items:center; justify-content:center; z-index:1000;">
      <div style="background:white; border-radius:20px; padding:40px; max-width:350px; margin:auto; text-align:center;">
        <h2>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
        <div style="margin:18px 0; font-size:1.1rem;">í‰ê·  80ì  ì´ìƒìœ¼ë¡œ ëª¨ë“  ì„¸íŠ¸ë¥¼ ì™„ë£Œí–ˆì–´ìš”!</div>
        <button class="btn btn-success" onclick="closeSuccessPopup()">í™•ì¸</button>
        <div id="videoArea" style="margin-top:20px; display:none;"></div>
      </div>
    </div>
  </div>
  <script>
    // ê¶Œí•œ í™•ì¸
    function checkPermission() {
        // getCurrentUser í•¨ìˆ˜ê°€ ì •ì˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
        if (typeof getCurrentUser === 'undefined') {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            location.href = 'index.html';
            return false;
        }
        
        const currentUser = getCurrentUser();
        if (!currentUser) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            location.href = 'index.html';
            return false;
        }
        
        return true;
    }
    
    // íŒŒë‹‰ìŠ¤ í•™ìŠµ ë°ì´í„° (ì´ëª¨ì§€:ë‹¨ì–´) - ë‹¨ëª¨ìŒ ë‹¨ì–´ë“¤ê³¼ ì´ëª¨ì§€ ë§¤í•‘
    const phonicsData = {
        'a': [
            { emoji: 'ğŸ±', word: 'cat', meaning: 'ê³ ì–‘ì´' },
            { emoji: 'ğŸ§¢', word: 'hat', meaning: 'ëª¨ì' },
            { emoji: 'ğŸ¦‡', word: 'bat', meaning: 'ë°•ì¥' },
            { emoji: 'ğŸ€', word: 'rat', meaning: 'ì¥' },
            { emoji: 'ğŸ', word: 'bat', meaning: 'ë°©ë§ì´' },
            { emoji: 'ğŸ—ºï¸', word: 'map', meaning: 'ì§€ë„' },
            { emoji: 'ğŸ§¢', word: 'cap', meaning: 'ëª¨ì' },
            { emoji: 'ğŸ‘‹', word: 'tap', meaning: 'ê°€ë³ê²Œ ì¹˜ë‹¤' },
            { emoji: 'ğŸ¦µ', word: 'lap', meaning: 'ë¬´ë¦' },
            { emoji: 'ğŸ‘œ', word: 'bag', meaning: 'ê°€ë°©' },
            { emoji: 'ğŸ·ï¸', word: 'tag', meaning: 'ê¼¬ë¦¬í‘œ' },
            { emoji: 'ğŸ§½', word: 'rag', meaning: 'ê±¸ë ˆ' },
            { emoji: 'ğŸ›ï¸', word: 'mat', meaning: 'ë§¤íŠ¸' },
            { emoji: 'ğŸª‘', word: 'sat', meaning: 'ì•‰ì•˜ë‹¤' },
            { emoji: 'ğŸ·', word: 'fat', meaning: 'ëš±ëš±í•œ' }
        ],
        'e': [
            { emoji: 'ğŸ›ï¸', word: 'bed', meaning: 'ì¹¨ëŒ€' },
            { emoji: 'ğŸ”´', word: 'red', meaning: 'ë¹¨ê°„' },
            { emoji: 'ğŸ½ï¸', word: 'fed', meaning: 'ë¨¹ì˜€ë‹¤' },
            { emoji: 'ğŸ’¡', word: 'led', meaning: 'ì´ëŒì—ˆë‹¤' },
            { emoji: 'ğŸ“¥', word: 'get', meaning: 'ì–»ë‹¤' },
            { emoji: 'âœ…', word: 'let', meaning: 'í—ˆë½í•˜ë‹¤' },
            { emoji: 'ğŸ¤', word: 'met', meaning: 'ë§Œë‚¬ë‹¤' },
            { emoji: 'ğŸ•¸ï¸', word: 'net', meaning: 'ê·¸ë¬¼' },
            { emoji: 'ğŸ•', word: 'pet', meaning: 'ì• ì™„ë™ë¬¼' },
            { emoji: 'ğŸ“±', word: 'set', meaning: 'ë†“ë‹¤' },
            { emoji: 'ğŸ’§', word: 'wet', meaning: 'ì –ì€' },
            { emoji: 'ğŸ²', word: 'bet', meaning: 'ë‚´ê¸°í•˜ë‹¤' },
            { emoji: 'âœˆï¸', word: 'jet', meaning: 'ì œíŠ¸ê¸°' },
            { emoji: 'ğŸ¥', word: 'vet', meaning: 'ìˆ˜ì˜ì‚¬' },
            { emoji: 'ğŸ•³ï¸', word: 'den', meaning: 'êµ´' },
            { emoji: 'ğŸ”', word: 'hen', meaning: 'ì•”íƒ‰' },
            { emoji: 'ğŸ‘¨', word: 'men', meaning: 'ë‚¨ìë“¤' },
            { emoji: 'âœï¸', word: 'pen', meaning: 'íœ' },
            { emoji: 'ğŸ”Ÿ', word: 'ten', meaning: 'ì—´' }
        ],
        'i': [
            { emoji: 'ğŸ˜', word: 'big', meaning: 'í°' },
            { emoji: 'â›ï¸', word: 'dig', meaning: 'íŒŒë‹¤' },
            { emoji: 'ğŸŒ³', word: 'fig', meaning: 'ë¬´í™”ê³¼' },
            { emoji: 'ğŸ·', word: 'pig', meaning: 'ë¼ì§€' },
            { emoji: 'âš™ï¸', word: 'rig', meaning: 'ì¥ë¹„' },
            { emoji: 'ğŸ‘¨â€ğŸ¦²', word: 'wig', meaning: 'ê°€ë°œ' },
            { emoji: 'ğŸª', word: 'bit', meaning: 'ì¡°ê¸ˆ' },
            { emoji: 'ğŸ‘•', word: 'fit', meaning: 'ë§ë‹¤' },
            { emoji: 'ğŸ‘Š', word: 'hit', meaning: 'ì¹˜ë‹¤' },
            { emoji: 'ğŸ§°', word: 'kit', meaning: 'ë„êµ¬ìƒì' },
            { emoji: 'ğŸ’¡', word: 'lit', meaning: 'ë°í˜”ë‹¤' },
            { emoji: 'ğŸ•³ï¸', word: 'pit', meaning: 'êµ¬ë©ì´' },
            { emoji: 'ğŸª‘', word: 'sit', meaning: 'ì•‰ë‹¤' },
            { emoji: 'ğŸ§ ', word: 'wit', meaning: 'ì¬ì¹˜' },
            { emoji: 'ğŸ—‘ï¸', word: 'bin', meaning: 'í†µ' },
            { emoji: 'ğŸ”Š', word: 'din', meaning: 'ì†ŒìŒ' },
            { emoji: 'ğŸŸ', word: 'fin', meaning: 'ì§€ëŠëŸ¬ë¯¸' },
            { emoji: 'ğŸ“Œ', word: 'pin', meaning: 'í•€' },
            { emoji: 'ğŸ˜ˆ', word: 'sin', meaning: 'ì£„' },
            { emoji: 'ğŸ¥«', word: 'tin', meaning: 'ì£¼ì„' },
            { emoji: 'ğŸ†', word: 'win', meaning: 'ì´ê¸°ë‹¤' }
        ],
        'o': [
            { emoji: 'ğŸ•', word: 'dog', meaning: 'ê°œ' },
            { emoji: 'ğŸŒ«ï¸', word: 'fog', meaning: 'ì•ˆê°œ' },
            { emoji: 'ğŸ·', word: 'hog', meaning: 'ë¼ì§€' },
            { emoji: 'ğŸƒ', word: 'jog', meaning: 'ì¡°ê¹…í•˜ë‹¤' },
            { emoji: 'ğŸªµ', word: 'log', meaning: 'í†µë‚˜ë¬´' },
            { emoji: 'ğŸ“¦', word: 'box', meaning: 'ìƒì' },
            { emoji: 'ğŸ¦Š', word: 'fox', meaning: 'ì—¬ìš°' },
            { emoji: 'ğŸ§¦', word: 'sox', meaning: 'ì–‘ë§' },
            { emoji: 'ğŸ”¥', word: 'hot', meaning: 'ëœ¨ê±°ìš´' },
            { emoji: 'ğŸ²', word: 'lot', meaning: 'ë§ì´' },
            { emoji: 'âŒ', word: 'not', meaning: 'ì•„ë‹ˆë‹¤' },
            { emoji: 'ğŸ¯', word: 'pot', meaning: 'ëƒ„ë¹„' },
            { emoji: 'ğŸ', word: 'rot', meaning: 'ì©ë‹¤' },
            { emoji: 'ğŸ‘¶', word: 'tot', meaning: 'ì•„ê¸°' },
            { emoji: 'ğŸ”µ', word: 'dot', meaning: 'ì ' },
            { emoji: 'ğŸ›ï¸', word: 'cot', meaning: 'ê°„ì´ì¹¨ëŒ€' },
            { emoji: 'ğŸ¤–', word: 'bot', meaning: 'ë¡œë´‡' },
            { emoji: 'ğŸ“¥', word: 'got', meaning: 'ì–»ì—ˆë‹¤' }
        ],
        'u': [
            { emoji: 'ğŸ›', word: 'bug', meaning: 'ë²Œë ˆ' },
            { emoji: 'ğŸ¤—', word: 'hug', meaning: 'ì•ˆì•„ì£¼ë‹¤' },
            { emoji: 'ğŸ«–', word: 'jug', meaning: 'ì£¼ì „ì' },
            { emoji: 'â˜•', word: 'mug', meaning: 'ë¨¸ê·¸ì»µ' },
            { emoji: 'ğŸŸ«', word: 'rug', meaning: 'ëŸ¬ê·¸' },
            { emoji: 'ğŸš¢', word: 'tug', meaning: 'ëŒë‹¤' },
            { emoji: 'â›ï¸', word: 'dug', meaning: 'íŒ ë‹¤' },
            { emoji: 'ğŸ‘œ', word: 'lug', meaning: 'ëŒë‹¤' },
            { emoji: 'ğŸ•', word: 'pug', meaning: 'í¼ê·¸' },
            { emoji: 'ğŸ¯', word: 'sug', meaning: 'ì„¤íƒ•' },
            { emoji: 'ğŸ”„', word: 'but', meaning: 'í•˜ì§€ë§Œ' },
            { emoji: 'âœ‚ï¸', word: 'cut', meaning: 'ìë¥´ë‹¤' },
            { emoji: 'ğŸ«', word: 'gut', meaning: 'ì°½ì' },
            { emoji: 'ğŸ ', word: 'hut', meaning: 'ì˜¤ë‘ë§‰' },
            { emoji: 'ğŸ—¡ï¸', word: 'jut', meaning: 'íŠ€ì–´ë‚˜ì˜¤ë‹¤' },
            { emoji: 'ğŸ¥œ', word: 'nut', meaning: 'ê²¬ê³¼ë¥˜' },
            { emoji: 'ğŸ“¦', word: 'put', meaning: 'ë†“ë‹¤' },
            { emoji: 'ğŸ›¤ï¸', word: 'rut', meaning: 'ê³ ë‘' },
            { emoji: 'ğŸ˜¤', word: 'tut', meaning: 'í¥' },
            { emoji: 'ğŸ¥–', word: 'bun', meaning: 'ë¹µ' },
            { emoji: 'ğŸ‰', word: 'fun', meaning: 'ì¬ë¯¸' },
            { emoji: 'ğŸ”«', word: 'gun', meaning: 'ì´' },
            { emoji: 'ğŸ‘©â€ğŸ¦³', word: 'nun', meaning: 'ìˆ˜ë…€' },
            { emoji: 'ğŸ˜„', word: 'pun', meaning: 'ë§ì¥ë‚œ' },
            { emoji: 'ğŸƒ', word: 'run', meaning: 'ë‹¬ë¦¬ë‹¤' },
            { emoji: 'â˜€ï¸', word: 'sun', meaning: 'íƒœì–‘' },
            { emoji: 'ğŸ›¢ï¸', word: 'tun', meaning: 'í° í†µ' },
            { emoji: 'ğŸ»', word: 'cub', meaning: 'ìƒˆë¼' },
            { emoji: 'ğŸ¯', word: 'hub', meaning: 'ì¤‘ì‹¬' },
            { emoji: 'ğŸº', word: 'pub', meaning: 'ìˆ ì§‘' },
            { emoji: 'ğŸ¤²', word: 'rub', meaning: 'ë¬¸ì§€ë¥´ë‹¤' },
            { emoji: 'ğŸ›', word: 'tub', meaning: 'ìš•ì¡°' }
        ]
    };
    
    // í˜„ì¬ í•™ìŠµí•  ëª¨ìŒ ì„ íƒ (ë¼ìš´ë“œë³„ë¡œ ë‹¤ë¥¸ ëª¨ìŒ)
    function getCurrentVowel(round) {
        const vowels = ['a', 'e', 'i', 'o', 'u'];
        return vowels[(round - 1) % vowels.length];
    }
    
    // í˜„ì¬ ë¼ìš´ë“œì˜ ë‹¨ì–´ë“¤ ê°€ì ¸ì˜¤ê¸°
    function getCurrentWords(round) {
        const vowel = getCurrentVowel(round);
        return phonicsData[vowel];
    }
    let currentSet = null;
    let currentRound = 0;
    let score = 0;
    const ROUNDS_PER_SET = 5;
    const TOTAL_SETS = 3;
    let setScores = JSON.parse(localStorage.getItem('imageSetScores') || '[0,0,0]');
    let clearedSets = JSON.parse(localStorage.getItem('imageClearedSets') || '[false,false,false]');
    let selected = null;
    function renderSetSelect() {
      const area = document.getElementById('setSelectArea');
      let html = '<div style="margin-bottom:10px; font-weight:600;">ì„¸íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>';
      for(let i=1;i<=TOTAL_SETS;i++) {
        html += `<button class="btn" style="margin:0 8px 8px 0; min-width:80px;${clearedSets[i-1] ? 'background:#ccc;cursor:not-allowed;' : ''}" onclick="startSet(${i})" ${clearedSets[i-1] ? 'disabled' : ''}>${i}ì„¸íŠ¸${clearedSets[i-1] ? ' (ì™„ë£Œ)' : ''}</button>`;
      }
      html += '<button class="btn btn-secondary" style="margin-left:10px;" onclick="resetSets()">ì„¸íŠ¸ ì´ˆê¸°í™”</button>';
      area.innerHTML = html;
      document.querySelector('.game-info').style.display = 'none';
      document.querySelector('.question-area').style.display = 'none';
    }
    function startSet(setNum) {
      currentSet = setNum;
      currentRound = 0;
      score = 0;
      document.getElementById('score').textContent = score;
      document.getElementById('round').textContent = currentRound+1;
      document.querySelector('.game-info').style.display = '';
      document.querySelector('.question-area').style.display = '';
      document.getElementById('setSelectArea').innerHTML = '';
      renderQuestion();
    }
    function resetSets() {
      if(confirm('ì •ë§ ëª¨ë“  ì„¸íŠ¸ ê¸°ë¡ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) {
        setScores = [0,0,0];
        clearedSets = [false,false,false];
        localStorage.setItem('imageSetScores', JSON.stringify(setScores));
        localStorage.setItem('imageClearedSets', JSON.stringify(clearedSets));
        renderSetSelect();
      }
    }
    function renderQuestion() {
      document.getElementById('round').textContent = currentRound+1;
      document.getElementById('score').textContent = score;
      // í˜„ì¬ ë¼ìš´ë“œì— ë§ëŠ” ëª¨ìŒê³¼ ë‹¨ì–´ ì„ íƒ
      const currentVowel = getCurrentVowel(currentRound + 1);
      const currentWords = getCurrentWords(currentRound + 1);
      const randomWordData = currentWords[Math.floor(Math.random() * currentWords.length)];
      // ì´ëª¨ì§€ í‘œì‹œ (ì´ë¯¸ì§€ ëŒ€ì‹ )
      const imgElement = document.getElementById('questionImg');
      imgElement.style.display = 'none';
      let emojiContainer = document.getElementById('emojiContainer');
      if (!emojiContainer) {
        emojiContainer = document.createElement('div');
        emojiContainer.id = 'emojiContainer';
        emojiContainer.style.cssText = `
          width: 120px; 
          height: 120px; 
          background: #f8f9fa; 
          border: 2px solid #dee2e6; 
          border-radius: 12px; 
          display: flex; 
          align-items: center; 
          justify-content: center; 
          font-size: 4rem; 
          margin: 0 auto 18px auto;
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        `;
        imgElement.parentNode.insertBefore(emojiContainer, imgElement);
      }
      emojiContainer.textContent = randomWordData.emoji;
      // í˜„ì¬ í•™ìŠµ ì¤‘ì¸ ëª¨ìŒ í‘œì‹œ
      console.log(`ì„¸íŠ¸${currentSet} ë¼ìš´ë“œ${currentRound + 1}: ëª¨ìŒ '${currentVowel}' í•™ìŠµ ì¤‘ - ë‹¨ì–´: ${randomWordData.word} (${randomWordData.meaning}) - ì´ëª¨ì§€: ${randomWordData.emoji}`);
      const grid = document.getElementById('optionsGrid');
      grid.innerHTML = '';
      // ì„ íƒì§€ ìƒì„± (ì •ë‹µ + ë‹¤ë¥¸ ë‹¨ì–´ë“¤)
      const options = [randomWordData.word];
      const allWords = Object.values(phonicsData).flat().map(item => item.word);
      const otherWords = allWords.filter(word => word !== randomWordData.word);
      for (let i = 0; i < 3; i++) {
        const randomWord = otherWords[Math.floor(Math.random() * otherWords.length)];
        if (!options.includes(randomWord)) {
          options.push(randomWord);
        }
      }
      // ì„ íƒì§€ ì„ê¸°
      for (let i = options.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [options[i], options[j]] = [options[j], options[i]];
      }
      options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = opt;
        btn.onclick = () => selectOption(btn, opt);
        grid.appendChild(btn);
      });
      selected = null;
      document.getElementById('checkBtn').disabled = true;
      document.getElementById('nextBtn').disabled = true;
      document.getElementById('resultMessage').style.display = 'none';
    }
    function selectOption(btn, opt) {
      document.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));
      btn.classList.add('selected');
      selected = opt;
      document.getElementById('checkBtn').disabled = false;
    }
    function checkAnswer() {
      if (!selected) return;
      
      // í˜„ì¬ ë¼ìš´ë“œì˜ ì •ë‹µ ë‹¨ì–´ ê°€ì ¸ì˜¤ê¸°
      const currentVowel = getCurrentVowel(currentRound + 1);
      const currentWords = getCurrentWords(currentRound + 1);
      const emojiContainer = document.getElementById('emojiContainer');
      const currentEmoji = emojiContainer.textContent;
      const correctWordData = currentWords.find(item => item.emoji === currentEmoji);
      const correct = correctWordData ? correctWordData.word : '';
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.onclick = null;
        if (btn.textContent === correct) btn.classList.add('correct');
        else if (btn.textContent === selected) btn.classList.add('incorrect');
      });
      if (selected === correct) {
        score += 20;
        showResult('ì •ë‹µì…ë‹ˆë‹¤! +20ì ', true);
      } else {
        showResult(`í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µ: ${correct}`, false);
      }
      document.getElementById('checkBtn').disabled = true;
      document.getElementById('nextBtn').disabled = false;
      document.getElementById('score').textContent = score;
    }
    function showResult(msg, isCorrect) {
      const el = document.getElementById('resultMessage');
      el.textContent = msg;
      el.className = 'result-message ' + (isCorrect ? 'result-correct' : 'result-incorrect');
      el.style.display = 'block';
    }
    function nextRound() {
      currentRound++;
      if (currentRound >= ROUNDS_PER_SET) {
        setScores[currentSet-1] = score;
        clearedSets[currentSet-1] = true;
        localStorage.setItem('imageSetScores', JSON.stringify(setScores));
        localStorage.setItem('imageClearedSets', JSON.stringify(clearedSets));
        // í‰ê·  ì ìˆ˜ ê³„ì‚°
        const clearedCount = clearedSets.filter(Boolean).length;
        const avg = setScores.reduce((a,b)=>a+b,0) / clearedCount;
        if (clearedCount === TOTAL_SETS && avg >= 80) {
          showSuccessPopup(avg);
        } else {
          alert(`ì„¸íŠ¸ ì™„ë£Œ! ì ìˆ˜: ${score}`);
          renderSetSelect();
        }
        return;
      }
      renderQuestion();
    }
    function showSuccessPopup(avg) {
      document.getElementById('successPopup').style.display = 'flex';
      document.getElementById('videoArea').style.display = 'block';
      document.getElementById('videoArea').innerHTML = '<iframe width="300" height="170" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>';
    }
    function closeSuccessPopup() {
      document.getElementById('successPopup').style.display = 'none';
      renderSetSelect();
    }
    function goBack() { window.location.href = 'index.html'; }
    // ìµœì´ˆ ì§„ì… ì‹œ ì„¸íŠ¸ ì„ íƒ
    window.onload = function() {
      if (checkPermission()) {
        renderSetSelect();
      }
    };
  </script>
</body>
</html> 
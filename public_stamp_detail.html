<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µê°œ ìŠ¤í‹°ì»¤ í˜ì´ì§€ - ìƒˆë´„ì´ ì˜ì–´ ê³µë¶€</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="config.js"></script>
    <script src="user-theme.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', 'ë§‘ì€ ê³ ë”•', Arial, sans-serif;
            background: var(--user-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            color: #333;
            font-size: 1.3rem;
        }

        .header p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            padding: 40px 24px 32px 24px;
            max-width: 600px;
            width: 100%;
            margin: 80px auto 32px auto;
        }

        .back-btn {
            background: rgba(102, 126, 234, 0.2);
            border: none;
            color: #333;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        .back-btn:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        .page-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        .page-reward {
            color: #667eea;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .progress-info {
            margin-top: 15px;
            color: #666;
        }
        .stamps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stamp-item {
            aspect-ratio: 1;
            border: 3px dashed #e1e5e9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            position: relative;
            backdrop-filter: blur(5px);
            min-width: 80px;
            min-height: 80px;
        }
        .stamp-item:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #e3f0ff 0%, #d1e7ff 100%);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
        }
        .stamp-item.filled {
            border-style: solid;
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff 0%, #e3f0ff 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }
        .stamp-item.filled:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
            background: linear-gradient(135deg, #e3f0ff 0%, #d1e7ff 100%);
        }
        
        /* ëœë¤ ë°°ê²½ìƒ‰ í´ë˜ìŠ¤ë“¤ */
        .stamp-bg-pink {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%) !important;
        }
        .stamp-bg-blue {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%) !important;
        }
        .stamp-bg-purple {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%) !important;
        }
        .stamp-bg-green {
            background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%) !important;
        }
        .stamp-bg-orange {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%) !important;
        }
        .stamp-bg-yellow {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%) !important;
        }
        .stamp-bg-cyan {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%) !important;
        }
        .stamp-bg-mint {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%) !important;
        }

        .stamp-image {
            width: 70px;
            height: 70px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 50%;
            background-color: transparent;
            box-shadow: 
                0 4px 12px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        .stamp-image:hover {
            transform: scale(1.1) rotate(2deg);
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
        }
        .stamp-number {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .empty-stamp-text {
            color: #999;
            font-size: 0.9rem;
            text-align: center;
        }
        
        /* íŒì—… ìŠ¤íƒ€ì¼ */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .popup {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: popupSlideIn 0.3s ease-out;
        }
        @keyframes popupSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        .popup h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
        }
        .popup p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        .popup-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .popup-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .popup-btn:hover {
            transform: translateY(-2px);
        }
        .popup-btn.cancel {
            background: #6c757d;
            color: white;
        }
        .popup-btn.confirm {
            background: var(--user-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
            color: white;
        }
        
        /* ì¶•í•˜ íŒì—… */
        .celebration-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .celebration-content {
            background: white;
            border-radius: 25px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
            animation: celebrationBounce 0.6s ease-out;
        }
        @keyframes celebrationBounce {
            0% {
                opacity: 0;
                transform: scale(0.3) rotate(-10deg);
            }
            50% {
                transform: scale(1.1) rotate(5deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }
        .celebration-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: celebrationSpin 2s ease-in-out infinite;
        }
        @keyframes celebrationSpin {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }
        .celebration-title {
            font-size: 2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        .celebration-message {
            font-size: 1.2rem;
            color: #667eea;
            margin-bottom: 25px;
            line-height: 1.4;
        }
        .celebration-btn {
            background: var(--user-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .celebration-btn:hover {
            transform: translateY(-2px);
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px 15px;
                margin: 70px auto 20px auto;
            }
            .header {
                padding: 12px 15px;
            }
            .header h1 {
                font-size: 1.2rem;
            }
            .header p {
                font-size: 0.8rem;
            }
            .header-buttons {
                gap: 8px;
            }
            .back-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            .stamps-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            .stamp-item {
                padding: 15px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-buttons">
            <button class="back-btn" onclick="location.href='index.html'">â† ë’¤ë¡œ</button>
            <button class="back-btn" onclick="location.href='index.html'" style="background: var(--user-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%)); color: white;">ğŸ  í™ˆìœ¼ë¡œ</button>
        </div>
        <h1 id="pageTitle">ê³µê°œ ìŠ¤í‹°ì»¤ í˜ì´ì§€</h1>
        <p id="pageReward">ëˆ„êµ¬ë‚˜ ì°¸ì—¬í•  ìˆ˜ ìˆëŠ” ìŠ¤í‹°ì»¤ í˜ì´ì§€ì…ë‹ˆë‹¤!</p>
    </div>
    <div class="container">
        <div class="page-info">
            <div class="page-title" id="infoTitle">ê³µê°œ ìŠ¤í‹°ì»¤ í˜ì´ì§€</div>
            <div class="page-reward" id="infoReward">í•¨ê»˜ ìŠ¤í‹°ì»¤ë¥¼ ëª¨ì•„ë³´ì„¸ìš”!</div>
            <div class="progress-info" id="progressInfo">ì§„í–‰ ìƒí™©</div>
        </div>
        
        <div class="stamps-grid" id="stampsGrid">
            <!-- ìŠ¤íƒ¬í”„ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
    </div>
    
    <!-- ìŠ¤íƒ¬í”„ ì°ê¸° í™•ì¸ íŒì—… -->
    <div class="popup-overlay" id="stampPopup">
        <div class="popup">
            <h3>ğŸ¯ ë„ì¥ì„ ì°ì„ê¹Œìš”?</h3>
            <p>ì´ ìœ„ì¹˜ì— ë„ì¥ì„ ì°ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?<br>ëœë¤í•œ ìºë¦­í„°ê°€ ë‚˜íƒ€ë‚  ê±°ì˜ˆìš”!</p>
            <div class="popup-buttons">
                <button class="popup-btn cancel" onclick="closeStampPopup()">ì·¨ì†Œ</button>
                <button class="popup-btn confirm" onclick="confirmStamp()">í™•ì¸</button>
            </div>
        </div>
    </div>
    
    <!-- ì¶•í•˜ íŒì—… -->
    <div class="celebration-popup" id="celebrationPopup">
        <div class="celebration-content">
            <div class="celebration-icon">ğŸ‰</div>
            <div class="celebration-title">ì¶•í•˜í•©ë‹ˆë‹¤!</div>
            <div class="celebration-message" id="celebrationMessage">
                ëª¨ë“  ìŠ¤í‹°ì»¤ë¥¼ ëª¨ì•˜ìŠµë‹ˆë‹¤!<br>
                ì •ë§ ëŒ€ë‹¨í•´ìš”! ğŸ‘
            </div>
            <button class="celebration-btn" onclick="closeCelebrationPopup()">í™•ì¸</button>
        </div>
    </div>

    <script>
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤íƒ¬í”„ ë°ì´í„° ê´€ë¦¬
        const STORAGE_KEY = 'public_stamp_data';
        const TOTAL_STAMPS = 12; // ì´ ìŠ¤íƒ¬í”„ ê°œìˆ˜
        const MAX_CHAR_IMAGES = 130; // ìµœëŒ€ ìºë¦­í„° ì´ë¯¸ì§€ ë²ˆí˜¸
        
        let stamps = [];
        let selectedStampPosition = null;
        
        // URLì—ì„œ í˜ì´ì§€ ID ê°€ì ¸ì˜¤ê¸° (ì„ íƒì‚¬í•­)
        const urlParams = new URLSearchParams(window.location.search);
        const pageId = urlParams.get('id') || 'public';
        
        function loadPageData() {
            console.log('ê³µê°œ ìŠ¤íƒ¬í”„ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìŠ¤íƒ¬í”„ ë°ì´í„° ë¡œë“œ
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                try {
                    stamps = JSON.parse(savedData);
                    console.log('ì €ì¥ëœ ìŠ¤íƒ¬í”„ ë°ì´í„° ë¡œë“œ:', stamps);
                } catch (error) {
                    console.error('ì €ì¥ëœ ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', error);
                    stamps = [];
                }
            }
            
            // ì´ˆê¸° ìŠ¤íƒ¬í”„ ë°ì´í„° ìƒì„± (ì—†ëŠ” ê²½ìš°)
            if (stamps.length === 0) {
                stamps = Array.from({ length: TOTAL_STAMPS }, (_, index) => ({
                    position: index + 1,
                    stamp_type: null,
                    char_image: null
                }));
                saveStampsData();
            }
            
            renderPage();
        }
        
        function saveStampsData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(stamps));
            console.log('ìŠ¤íƒ¬í”„ ë°ì´í„° ì €ì¥ ì™„ë£Œ');
        }
        
        function renderPage() {
            // í—¤ë” ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('pageTitle').textContent = 'ê³µê°œ ìŠ¤í‹°ì»¤ í˜ì´ì§€';
            document.getElementById('infoTitle').textContent = 'ê³µê°œ ìŠ¤í‹°ì»¤ í˜ì´ì§€';
            document.getElementById('infoReward').textContent = 'í•¨ê»˜ ìŠ¤í‹°ì»¤ë¥¼ ëª¨ì•„ë³´ì„¸ìš”!';
            
            // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
            const completedStamps = stamps.filter(s => s.stamp_type !== null).length;
            const progressText = `${completedStamps}/${TOTAL_STAMPS} ì™„ë£Œ`;
            document.getElementById('progressInfo').textContent = progressText;
            
            // ìŠ¤íƒ¬í”„ ê·¸ë¦¬ë“œ ë Œë”ë§
            const stampsGrid = document.getElementById('stampsGrid');
            stampsGrid.innerHTML = '';
            
            for (let i = 1; i <= TOTAL_STAMPS; i++) {
                const stamp = stamps.find(s => s.position === i);
                const isFilled = stamp && stamp.stamp_type !== null;
                
                console.log(`ìŠ¤íƒ¬í”„ ${i} ë Œë”ë§:`, { stamp, isFilled });
                
                const stampItem = document.createElement('div');
                const bgClasses = ['stamp-bg-pink', 'stamp-bg-blue', 'stamp-bg-purple', 'stamp-bg-green', 'stamp-bg-orange', 'stamp-bg-yellow', 'stamp-bg-cyan', 'stamp-bg-mint'];
                // ìœ„ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ê³ ì •ëœ ë°°ê²½ìƒ‰ í• ë‹¹ (ê°™ì€ ìœ„ì¹˜ëŠ” í•­ìƒ ê°™ì€ ìƒ‰ìƒ)
                const fixedBgClass = bgClasses[(i - 1) % bgClasses.length];
                stampItem.className = `stamp-item ${isFilled ? 'filled' : ''} ${isFilled ? fixedBgClass : ''}`;
                
                // ìŠ¤íƒ¬í”„ í´ë¦­ ì´ë²¤íŠ¸
                stampItem.onclick = () => {
                    console.log(`ìŠ¤íƒ¬í”„ ${i} í´ë¦­`);
                    handleStampClick(i);
                };
                
                const stampNumber = document.createElement('div');
                stampNumber.className = 'stamp-number';
                stampNumber.textContent = i;
                stampItem.appendChild(stampNumber);
                
                if (isFilled) {
                    const stampImage = document.createElement('div');
                    stampImage.className = 'stamp-image';
                    
                    // ìºë¦­í„° ì´ë¯¸ì§€ ì„¤ì •
                    const charImageNum = stamp.char_image || 1;
                    const imagePath = `../img/char_${String(charImageNum).padStart(3, '0')}.png`;
                    stampImage.style.backgroundImage = `url('${imagePath}')`;
                    
                    console.log(`ìŠ¤íƒ¬í”„ ì´ë¯¸ì§€ ì„¤ì •:`, {
                        position: i,
                        charImageNum: charImageNum,
                        imagePath: imagePath
                    });
                    
                    stampItem.appendChild(stampImage);
                } else {
                    const emptyText = document.createElement('div');
                    emptyText.className = 'empty-stamp-text';
                    emptyText.textContent = 'í„°ì¹˜í•˜ì—¬\në„ì¥ ì°ê¸°';
                    stampItem.appendChild(emptyText);
                }
                
                stampsGrid.appendChild(stampItem);
            }
        }
        
        function handleStampClick(position) {
            console.log('ìŠ¤íƒ¬í”„ í´ë¦­:', position);
            
            const stamp = stamps.find(s => s.position === position);
            console.log('ì°¾ì€ ìŠ¤íƒ¬í”„:', stamp);
            
            if (stamp && stamp.stamp_type !== null) {
                console.log('ì´ë¯¸ ì°íŒ ìŠ¤íƒ¬í”„ì…ë‹ˆë‹¤.');
                return; // ì´ë¯¸ ì°íŒ ìŠ¤íƒ¬í”„ëŠ” í´ë¦­ ë¶ˆê°€
            }
            
            selectedStampPosition = position;
            console.log('ì„ íƒëœ ìŠ¤íƒ¬í”„ ìœ„ì¹˜:', selectedStampPosition);
            document.getElementById('stampPopup').style.display = 'flex';
        }
        
        function closeStampPopup() {
            document.getElementById('stampPopup').style.display = 'none';
            selectedStampPosition = null;
        }
        
        function confirmStamp() {
            console.log('confirmStamp í˜¸ì¶œë¨, selectedStampPosition:', selectedStampPosition);
            
            if (!selectedStampPosition) {
                console.error('selectedStampPositionì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                alert('ìŠ¤íƒ¬í”„ ìœ„ì¹˜ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë³€ìˆ˜ ë³µì‚¬ (ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)
            const position = selectedStampPosition;
            
            console.log('ë³€ìˆ˜ í™•ì¸:', { position, selectedStampPosition });
            
            closeStampPopup();
            
            try {
                console.log('ìŠ¤íƒ¬í”„ ë“±ë¡ ì‹œì‘:', { position: position });
                
                // ëœë¤ ìºë¦­í„° ì´ë¯¸ì§€ ë²ˆí˜¸ ì„ íƒ (1~130)
                const randomCharImage = Math.floor(Math.random() * MAX_CHAR_IMAGES) + 1;
                console.log('ì„ íƒëœ ìºë¦­í„° ì´ë¯¸ì§€ ë²ˆí˜¸:', randomCharImage);
                
                // í˜„ì¬ ìŠ¤íƒ¬í”„ ë°ì´í„° í™•ì¸
                const currentStamp = stamps.find(s => s.position === position);
                console.log('í˜„ì¬ ìŠ¤íƒ¬í”„ ë°ì´í„°:', currentStamp);
                
                if (!currentStamp) {
                    throw new Error(`ìœ„ì¹˜ ${position}ì˜ ìŠ¤íƒ¬í”„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }
                
                // ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸
                currentStamp.stamp_type = 1; // ê¸°ë³¸ê°’
                currentStamp.char_image = randomCharImage;
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                saveStampsData();
                
                console.log('ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
                // í˜ì´ì§€ ë‹¤ì‹œ ë Œë”ë§
                renderPage();
                
                // ì™„ë£Œ ì—¬ë¶€ í™•ì¸
                const completedStamps = stamps.filter(s => s.stamp_type !== null).length;
                console.log('ì™„ë£Œëœ ìŠ¤íƒ¬í”„ ìˆ˜:', completedStamps, '/', TOTAL_STAMPS);
                
                if (completedStamps >= TOTAL_STAMPS) {
                    setTimeout(() => {
                        showCelebrationPopup();
                    }, 500);
                }
                
            } catch (error) {
                console.error('ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                console.error('ì—ëŸ¬ ìƒì„¸:', {
                    message: error.message,
                    stack: error.stack
                });
                
                let errorMessage = 'ìŠ¤íƒ¬í”„ë¥¼ ì°ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                if (error.message) {
                    errorMessage += `\nì—ëŸ¬: ${error.message}`;
                }
                
                alert(errorMessage + '\n\në¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì˜ ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }
        
        function showCelebrationPopup() {
            const message = `ğŸ‰ ê³µê°œ ìŠ¤í‹°ì»¤ í˜ì´ì§€ ì™„ë£Œ! ğŸ‰\n\nëª¨ë“  ìŠ¤í‹°ì»¤ë¥¼ ëª¨ì•˜ìŠµë‹ˆë‹¤!\n\nì •ë§ ëŒ€ë‹¨í•´ìš”! ğŸ‘`;
            document.getElementById('celebrationMessage').innerHTML = message.replace(/\n/g, '<br>');
            document.getElementById('celebrationPopup').style.display = 'flex';
        }
        
        function closeCelebrationPopup() {
            document.getElementById('celebrationPopup').style.display = 'none';
        }
        
        // ESC í‚¤ë¡œ íŒì—… ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeStampPopup();
                closeCelebrationPopup();
            }
        });
        
        // íŒì—… ì™¸ë¶€ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
        document.getElementById('stampPopup').addEventListener('click', function(e) {
            if (e.target === this) {
                closeStampPopup();
            }
        });
        
        document.getElementById('celebrationPopup').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCelebrationPopup();
            }
        });
        
        window.onload = loadPageData;
    </script>
</body>
</html>
